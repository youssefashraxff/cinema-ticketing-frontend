<section class="py-32">
  <div class="container mx-auto max-w-6xl">
    <h1 class="text-white uppercase font-extrabold text-3xl">Choose seats</h1>
    <!-- Hall -->
    <div class="max-w-1/3 mx-auto my-10 flex flex-col justify-center items-center">
      <img src="/images/screen.svg" alt="" />
      <h1 class="text-white uppercase font-light tracking-widest text-xl">Screen</h1>
      <!-- Seats -->
      <div class="my-5">
        @if (availableSeats$ | async; as availableSeats) {
        <div class="flex flex-col gap-4 items-center">
          @for (row of ['A','B','C','D','E']; track row) {
          <div class="flex items-center">
            <span class="w-6 mr-3 text-gray-400 font-semibold">{{ row }}</span>

            <div class="flex gap-3">
              <!-- Group 1 (2 seats) -->
              <div class="flex gap-2">
                @for (seat of [1,2]; track seat) {
                <div
                  class="seat"
                  [class.available-seat]="isSeatAvailable(row, seat, availableSeats)"
                  [class.occupied-seat]="!isSeatAvailable(row, seat, availableSeats)"
                  [class.selected-seat]="isSeatSelected(row, seat)"
                  (click)="toggleSeat(row, seat, availableSeats)"
                ></div>
                }
              </div>

              <!-- Group 2 (4 seats) -->
              <div class="flex gap-2 mx-4">
                @for (seat of [3,4,5,6]; track seat) {
                <div
                  class="seat"
                  [class.available-seat]="isSeatAvailable(row, seat, availableSeats)"
                  [class.occupied-seat]="!isSeatAvailable(row, seat, availableSeats)"
                  [class.selected-seat]="isSeatSelected(row, seat)"
                  (click)="toggleSeat(row, seat, availableSeats)"
                ></div>
                }
              </div>

              <!-- Group 3 (2 seats) -->
              <div class="flex gap-2">
                @for (seat of [7,8]; track seat) {
                <div
                  class="seat"
                  [class.available-seat]="isSeatAvailable(row, seat, availableSeats)"
                  [class.occupied-seat]="!isSeatAvailable(row, seat, availableSeats)"
                  [class.selected-seat]="isSeatSelected(row, seat)"
                  (click)="toggleSeat(row, seat, availableSeats)"
                ></div>
                }
              </div>
            </div>
          </div>
          }
        </div>
        } @else {
        <app-loading-spinner />
        }
      </div>
    </div>
    <!-- Seat Legend -->
    <div class="flex justify-center gap-8 my-8 text-sm text-gray-300">
      <!-- Available -->
      <div class="flex items-center gap-2">
        <div class="seat border-main"></div>
        <span>Available</span>
      </div>

      <!-- Selected -->
      <div class="flex items-center gap-2">
        <div class="selected-seat"></div>
        <span>Selected</span>
      </div>

      <!-- Occupied -->
      <div class="flex items-center gap-2">
        <div class="occupied-seat"></div>
        <span>Occupied</span>
      </div>
    </div>
    <hr class="border-neutral-700 w-3/4 mx-auto" />
    <!-- Details -->
    <div class="mt-8 max-w-1/2 mx-auto">
      <div class="bg-neutral-900 rounded-xl p-6 space-y-6">
        <!-- Header -->
        <h2 class="text-white font-semibold text-xl">Booking summary</h2>

        <!-- Selected Seats -->
        <div>
          <p class="text-gray-400 text-sm mb-2">Selected seats</p>
          <div class="flex flex-wrap gap-2">
            @for (seat of selectedSeats; track seat.seatId) {
            <span class="px-3 py-1 rounded-full bg-main text-black text-sm font-medium">
              {{ seat.seatId }}
            </span>
            }
          </div>
        </div>

        <!-- Divider -->
        <hr class="border-neutral-700" />

        <!-- Ticket Details -->
        @if(show$ | async; as show) {
        <div class="space-y-2 text-sm text-gray-300">
          <div class="flex justify-between">
            <span>Movie</span>
            <span class="text-white font-medium">{{ show.movie.name }}</span>
          </div>

          <div class="flex justify-between">
            <span>Date</span>
            <span class="text-white font-medium">{{ show.startTime | date : 'dd MMM yyyy' }}</span>
          </div>

          <div class="flex justify-between">
            <span>Time</span>
            <span class="text-white font-medium">{{ show.startTime | date : 'shortTime' }}</span>
          </div>

          <div class="flex justify-between">
            <span>Hall</span>
            <span class="text-white font-medium">{{ show.hall.hallId }}</span>
          </div>
        </div>
        }

        <!-- Payment Options -->
        <form [formGroup]="paymentForm" class="space-y-3">
          <p class="text-gray-400 text-sm">Payment method</p>

          <!-- Credit Card -->
          <div
            class="flex items-center justify-between p-3 rounded-lg border border-neutral-700 hover:border-main transition"
          >
            <div class="flex items-center gap-3">
              <input
                type="radio"
                id="card"
                name="payment"
                value="CARD"
                class="accent-main cursor-pointer z-10"
                [(ngModel)]="selectedPayment"
                checked
              />
              <label for="card" class="text-white font-medium cursor-pointer">
                Credit / Debit Card
              </label>
            </div>
            <i class="fa-brands fa-cc-visa text-2xl text-white"></i>
          </div>
          @if (selectedPayment === 'CARD') {
          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <input
              type="text"
              formControlName="cardNumber"
              placeholder="Card Number"
              class="bg-background border border-gray-600 text-white rounded-lg p-2.5"
            />
            <input
              type="text"
              formControlName="cardHolder"
              placeholder="Card Holder Name"
              class="bg-background border border-gray-600 text-white rounded-lg p-2.5"
            />
            <input
              type="text"
              formControlName="expiry"
              placeholder="Expiry Date (MM/YY)"
              class="bg-background border border-gray-600 text-white rounded-lg p-2.5"
            />
            <input
              type="password"
              formControlName="cvv"
              placeholder="CVV"
              class="bg-background border border-gray-600 text-white rounded-lg p-2.5"
            />
          </div>
          }

          <!-- PayPal -->
          <div
            class="flex items-center justify-between p-3 rounded-lg border border-neutral-700 hover:border-main transition"
          >
            <div class="flex items-center gap-3">
              <input
                type="radio"
                id="paypal"
                name="payment"
                value="PAYPAL"
                class="accent-main cursor-pointer z-10"
                [(ngModel)]="selectedPayment"
              />
              <label for="paypal" class="text-white font-medium cursor-pointer"> PayPal </label>
            </div>
            <i class="fa-brands fa-paypal text-2xl text-white"></i>
          </div>
          @if (selectedPayment === 'PAYPAL') {
          <div class="mt-4">
            <input
              type="email"
              formControlName="paypalEmail"
              placeholder="PayPal Email"
              class="bg-background border border-gray-600 text-white rounded-lg p-2.5 w-full"
            />
          </div>
          }

          <!-- Cash -->
          <div
            class="flex items-center justify-between p-3 rounded-lg border border-neutral-700 hover:border-main transition"
          >
            <div class="flex items-center gap-3">
              <input
                type="radio"
                id="cash"
                name="payment"
                value="CASH"
                class="accent-main cursor-pointer z-10"
                [(ngModel)]="selectedPayment"
              />
              <label for="cash" class="text-white font-medium cursor-pointer">
                Cash at Cinema
              </label>
            </div>
            <i class="fa-solid fa-money-bill-1 text-xl text-white"></i>
          </div>
        </form>

        <!-- Divider -->
        <hr class="border-neutral-700" />

        <!-- Total -->
        <div class="flex justify-between font-semibold text-base">
          <span class="text-white">Total</span>
          <span class="text-main">{{ totalPrice | currency : ' EGP' }}</span>
        </div>

        <!-- CTA -->
        <button
          class="w-full py-3 rounded-xl bg-main text-white cursor-pointer font-bold hover:bg-main-muted transition"
          (click)="confirmPayment()"
        >
          Confirm booking
        </button>
      </div>
    </div>
  </div>
</section>
