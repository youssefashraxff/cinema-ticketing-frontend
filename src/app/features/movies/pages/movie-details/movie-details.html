@if (movie$ | async; as movie) {
<section>
  <!-- Movie Details -->

  <div class="movie-backdrop pt-36 pb-12">
    <div class="container max-w-6xl mx-auto">
      <div class="grid grid-cols-11 gap-18">
        <div class="col-span-3">
          <!-- <p>{{ movie.verticalPoster }}</p> -->
          <img class="rounded-md" [src]="movie.verticalPoster" alt="" />
        </div>
        <div class="col-span-8 flex flex-col gap-6 text-white py-10">
          <p class="text-3xl font-bold uppercase">{{ movie.name }}</p>
          <p class="text-lg font-semibold uppercase">
            Genre: <span class="font-light">{{ movie.movieCategory.type }}</span>
          </p>
          <div>
            <p class="text-white font-bold text-sm">
              <i class="fas fa-globe"></i>
              Language: <span class="font-light">{{ movie.language }}</span>
            </p>
            <p class="text-white font-bold text-sm">
              <i class="fas fa-clock"></i>
              Duration: <span class="font-light">{{ movie.duration }} min</span>
            </p>
          </div>
          <div>
            <p class="text-xl font-normal mb-3">Overview</p>
            <p class="text-md font-light text-gray-100">
              {{ movie.MovieDescription }}
            </p>
          </div>
          <div>
            <a [href]="movie.trailerURL" target="_blank">
              <button
                class="block rounded-full uppercase text-white border-main border py-2 px-6 cursor-pointer hover:bg-main-muted text-sm font-extrabold transition duration-200"
              >
                <i class="fas fa-play"></i> Play trailer
              </button>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Showdays & Showtimes -->
  <div class="my-10">
    <div class="container max-w-6xl mx-auto">
      <h2 class="text-2xl text-white font-extrabold uppercase mb-6">Showdays</h2>

      @if (shows$ | async; as shows) {

      <!-- Unique Days -->
      <div class="flex gap-4 mb-10">
        @for (day of getUniqueDays(shows); track day) {
        <div
          (click)="selectDay(day)"
          class="py-3 px-5 rounded-2xl cursor-pointer border shadow-lg flex flex-col justify-center items-center text-center transition"
          [ngClass]="{
            'border-main bg-linear-to-br from-neutral-900 to-neutral-800':
              selectedDay === day.toDateString(),
            'border-gray-700 bg-neutral-900/60 hover:border-main':
              selectedDay !== day.toDateString()
          }"
        >
          <p class="text-main font-semibold text-sm">
            {{ day | date : 'EEE' }}
          </p>
          <p class="text-main text-lg font-extrabold uppercase">
            {{ day | date : 'dd MMM' }}
          </p>
        </div>
        }
      </div>

      <!-- Halls with grouped showtimes -->
      <div class="flex flex-col gap-8">
        @for (hall of getShowsGroupedByHall(shows); track hall.hallId) {

        <div>
          <p class="text-white font-bold text-lg mb-3">Hall {{ hall.hallId }}</p>

          <div class="flex gap-4 flex-wrap">
            @for (show of hall.shows; track show.showId) {
            <a [routerLink]="['/booking', show.showId, 'seats']" class="group">
              <div class="relative inline-flex items-center justify-center">
                <span
                  class="bg-white p-2 rounded-md text-xs font-semibold text-black group-hover:bg-white/50"
                >
                  {{ show.startTime | date : 'shortTime' }}
                </span>
              </div>
            </a>
            }
          </div>
        </div>

        }
      </div>

      }
    </div>
  </div>
  <!-- Rating and Reviews -->
  <!-- ================= Reviews ================= -->
  <div class="my-16">
    <div class="container max-w-4xl mx-auto text-white">
      <h2 class="text-2xl font-extrabold uppercase mb-6">Ratings & Reviews</h2>

      <!-- Add Review -->
      <div class="bg-neutral-900 rounded-xl p-6 mb-10">
        <h3 class="text-lg font-bold mb-4">Leave a review</h3>

        <div class="flex flex-col gap-4">
          <!-- Rating -->
          <select
            class="bg-background border border-gray-600 rounded-lg p-2 text-white"
            [(ngModel)]="rating"
          >
            <option value="">Select rating</option>
            @for (r of [1,2,3,4,5]; track r) {
            <option [value]="r">{{ r }} â˜…</option>
            }
          </select>

          <!-- Comment -->
          <textarea
            rows="3"
            placeholder="Write your review..."
            class="bg-background border border-gray-600 rounded-lg p-2 text-white"
            [(ngModel)]="comment"
          ></textarea>

          <!-- Submit -->
          <button
            class="self-start bg-main hover:bg-main-muted text-black font-semibold px-6 py-2 rounded-lg"
            (click)="submitReview()"
          >
            Submit Review
          </button>
        </div>
      </div>

      <!-- Reviews List -->
      @if (reviews$ | async; as reviews) { @if (reviews.length === 0) {
      <p class="text-gray-400 text-center">No reviews yet. Be the first to review this movie ðŸŽ¬</p>
      }

      <div class="flex flex-col gap-4">
        @for (review of reviews; track review.reviewId) {
        <div class="bg-neutral-900 rounded-xl p-5">
          <div class="flex justify-between items-center mb-2">
            <p class="font-semibold">{{ review.rating }} â˜…</p>
          </div>

          <p class="text-gray-300 text-sm">
            {{ review.comment }}
          </p>
        </div>
        }
      </div>

      }
    </div>
  </div>
</section>

} @else {
<app-loading-spinner />
}
